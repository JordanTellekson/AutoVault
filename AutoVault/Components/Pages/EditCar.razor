@page "/cars/edit/{CarId:guid}"
@using AutoVault.Models
@inject AutoVault.Services.ICarRepository CarRepository
@inject NavigationManager Navigation

<h3 class="car-page-title">Edit @_car?.Make @_car?.Model</h3>

@if (_car is null)
{
    <p>Loading…</p>
}
else
{
    <CarForm Car="_car" ButtonText="Save Changes" OnSubmit="SaveCar" OnCancel="Cancel" />
}

@code {
    // Route parameter for the car being edited
    [Parameter] public Guid CarId { get; set; }

    // Local reference to the car being edited
    private Car? _car;

    // Load the car on initialization; redirect to collection if not found
    protected override async Task OnInitializedAsync()
    {
        _car = await CarRepository.GetCarByIdAsync(CarId);
        if (_car is null)
            Navigation.NavigateTo("/cars");
    }

    // Handle form submission: update the car and return to the car collection
    private async Task SaveCar(Car car)
    {
        if (_car is null) return;

        await CarRepository.UpdateCarAsync(car);
        Navigation.NavigateTo("/cars");
    }

    // Handle form cancellation: navigate back to the car collection without saving
    private void Cancel() => Navigation.NavigateTo("/cars");
}